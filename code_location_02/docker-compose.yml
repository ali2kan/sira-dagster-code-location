services:
  pipeline_x:
    # image: pipeline-x
    image: ghcr.io/ali2kan/sira-dagster-standard-pipeline:multiarch
    platform: linux/amd64
    # platform: linux/arm64
    hostname: pipeline_x
    environment:
      # DAGSTER_PG_USER: ${DAGSTER_PG_USER}
      # DAGSTER_PG_PASSWORD: ${DAGSTER_PG_PASSWORD}
      # DAGSTER_PG_DB: ${DAGSTER_PG_DB}
      DAGSTER_POSTGRES_USER: "postgres_user"
      DAGSTER_POSTGRES_PASSWORD: "postgres_password"
      DAGSTER_POSTGRES_DB: "postgres_db"
      DAGSTER_CURRENT_IMAGE: "pipeline-x"
      PIPELINE_NAME: "standard_pipeline"
      GRPC_PORT: "4000"
    ports:
      - "4000:4000"
    networks:
      - dagster_network
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "4000"]
      interval: 10s
      retries: 3

networks:
  dagster_network:
    external: true
    name: dagster_network
